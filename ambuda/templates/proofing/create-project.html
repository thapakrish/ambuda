{% extends 'proofing/base.html' %}

{% import "macros/components.html" as components %}
{% import "macros/proofing.html" as m %}
{% import "macros/talk.html" as m_talk %}
{% import "macros/forms.html" as mf %}


{% macro _radio2(field, model) %}
<div class="flex items-center">
  {{ field(**{"class_": "w-4 mr-2", "x-model": model}) }}
  {{ field.label(class_="cursor-pointer") }}
</div>
{% endmacro %}


{% block title %}Create project | Ambuda{% endblock %}


{% block content %}
{{ m.title_and_subtitle(
    _("Create project"),
    "Use our simple uploader to create a new proofing project.") }}


{{ components.flash_messages() }}
{{ mf.show_errors_if_any(form.errors) }}


<form action="" method="POST" enctype="multipart/form-data"
  x-data="{ source: '{{ form.pdf_source.data }}'}">
{{ form.csrf_token }}

{% set radios = form.pdf_source|list %}
<fieldset x-ref="source" class="p-4 my-8 bg-slate-100">
  {{ _radio2(radios[0], "source") }}
  <div class="ml-6 my-4" x-show="source === 'url'">
    <p>We'll fetch a PDF from the given URL. Please provide the full URL to
    the PDF file (e.g., from archive.org, Google Drive, Dropbox, or any other
    publicly accessible URL).</p>

    <div class="my-4">
      {{ form.pdf_url(class_="rounded border p-2 w-full", placeholder="https://example.com/document.pdf") }}
    </div>
  </div>

  {{ _radio2(radios[1], "source") }}
  <div class="ml-6 my-4" x-show="source === 'local'">
    <p>We'll copy the PDF from your computer. Please use the form below to find
    a PDF on your computer:</p>

    <div class="my-4 bg-slate-100">
      {{ form.local_file }}
    </div>
  </div>

  {#
  {{ _radio2(radios[2], "source") }}
  <div class="ml-6 my-4" x-show="source === 'gdrive'">
    <p>We'll fetch all PDFs from a public Google Drive folder and create one
    project for each PDF. The folder must be publicly accessible without login.
    Please provide the folder URL:</p>

    <div class="my-4">
      {{ form.gdrive_folder_url(class_="rounded border p-2 w-full", placeholder="https://drive.google.com/drive/folders/...") }}
    </div>

    <div class="prose ml-0 mt-4">
      <p class="text-sm"><strong>Note:</strong> To share a Google Drive folder publicly:</p>
      <ol class="text-sm">
        <li>Right-click the folder and select "Share".</li>
        <li>Click "Change to anyone with the link".</li>
        <li>Set permission to "Viewer".</li>
        <li>Copy the link and paste it above.</li>
      </ol>
    </div>
  </div>
  #}

</fieldset>

<div class="my-4">
  {{ form.display_title.label(class_="block mb-2") }}
  {{ form.display_title(class_="rounded border p-2 w-full", placeholder="Leave blank to auto-generate from file hash") }}
</div>

<input class="block btn btn-submit" type="submit" value="Create project">
</form>
{% endblock %}
